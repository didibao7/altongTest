"use strict";var mask=document.querySelector(".mask"),sendMsg=document.querySelector(".send_popup"),receiveMsg=document.querySelector(".receive_popup"),addToast=document.querySelector(".block_add_toast"),removeToast=document.querySelector(".block_remove_toast");function checkDeviceSize(){var a=receiveMsg.offsetWidth,b=receiveMsg.offsetHeight,c=sendMsg.offsetWidth,d=sendMsg.offsetHeight,e=window.innerWidth,f=window.innerHeight;addToast.style.left=(e-addToast.offsetWidth)/2+"px",addToast.style.top=(f-addToast.offsetHeight)/2+"px",removeToast.style.left=(e-removeToast.offsetWidth)/2+"px",removeToast.style.top=(f-removeToast.offsetHeight)/2+"px",receiveMsg.style.left=(e-a)/2+"px",receiveMsg.style.top=(f-b)/2+"px",sendMsg.style.left=(e-c)/2+"px",sendMsg.style.top=(f-d)/2+"px"}function openMessage(a){$(a).find(".user_receive_msg").length?(document.querySelector(".msg_write_ta01").value="",receiveMsg.style.display="block",sendMsg.style.display="none",mask.style.display="block",checkDeviceSize(),fSetMessage(a)):(document.querySelector(".msg_write_ta02").value="",receiveMsg.style.display="none",sendMsg.style.display="block",mask.style.display="block",checkDeviceSize(),fSetMessage(a)),mask.addEventListener("click",function(){sendMsg.style.display="none",receiveMsg.style.display="none",mask.style.display="none"})}function fSetMessage(a){a=$(a);var b=$(".user_message");b.find("input[name=MsgSeq]").val(a.attr("msg_seq")),b.find("input[name=MemberSeq]").val(a.attr("member_seq")),b.find(".user_message_top > img").attr("src",a.find(".msg_user_img").attr("src")),b.find(".user_name").text(a.find(".msg_user_name").text()),b.find(".msg_time").text(a.find(".msg_time").text()),b.find(".msg_read_ta").text(a.find(".msg_user_text").text()),b.find(".msg_write_ta").attr("placeholder",a.find(".msg_user_name").text()+"\uB2D8\uAED8 \uBCF4\uB0B4\uC2E4 \uB0B4\uC6A9\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694."),fShowBlock(a.hasClass("msg_el_block")),fAjax("/Message/message.alt","","ACT=SET_READ&MsgSeq="+a.attr("msg_seq"))}function closeAll(a){var b=function(){sendMsg.style.display="none",receiveMsg.style.display="none",mask.style.display="none"};return function(){b(a)}}function fShowBlock(a,b){var c=$(".user_message"),d=function(){return{userName:c.find(".user_name"),userNameSpan:c.find(".user_name_block"),icon:c.find(".user_message_block .material-icons"),iconText:c.find(".user_message_block span")}};$(".block_remove_toast").stop().hide(),$(".block_add_toast").stop().hide(),a?(function addBlock(){var a=d(),b=a.userName,c=a.userNameSpan,e=a.icon,f=a.iconText;b.css("color","red"),c.html("<i class='material-icons'>block</i>"),e.css("color","red"),f.text("\uD574\uC81C").css("color","red")}(),c.addClass("is_block"),b&&$(".block_add_toast").stop().fadeIn(400).delay(2e3).fadeOut(400)):(function removeBlock(){var a=d(),b=a.userName,c=a.userNameSpan,e=a.icon,f=a.iconText;b.css("color","#000080"),c.text(""),e.css("color","#333"),f.text("\uCC28\uB2E8").css("color","#333")}(),c.removeClass("is_block"),b&&$(".block_remove_toast").stop().fadeIn(400).delay(2e3).fadeOut(400)),checkDeviceSize()}function fSetBlock(){var a=$(".receive_popup input[name=MemberSeq]").val(),b=$(".receive_popup").hasClass("is_block")?"N":"Y";fAjax("/Message/message.alt","","ACT=SET_BLOCK&MemberSeq="+a+"&setBlock="+b)}function selectView(){$(".select_view").hide(),$("#"+$(".select_btn_selected").attr("tar_obj")).fadeIn(300),$(".select_div").click(function(a){var b=$(a.target);b.attr("tar_obj")||(b=b.closest(".select_btn"));var c=b.attr("tar_obj");c&&(b.hasClass("select_btn_selected")||($(".select_view").hide(),$(".select_btn").removeClass("select_btn_selected"),b.addClass("select_btn_selected"),$("#"+c).fadeIn(300),"function"==typeof libCallBackSelectView&&libCallBackSelectView(c)))})}function libCallBackSelectView(a){"select_view01"===a?($(".receive_message").find(".msg_el_con:not(:first)").remove(),pg=0,fAjax_List("ACT=LIST_RECEIVE")):"select_view02"===a?($(".send_message").find(".msg_el_con:not(:first)").remove(),pg=0,fAjax_List("ACT=LIST_SEND")):void 0}function fAjax(a,b,c){return document.xhr?($("#Tip").text("\uC774\uC804 \uC791\uC5C5\uC774 \uC9C4\uD589\uC911\uC785\uB2C8\uB2E4.").css("display","block"),void setTimeout(function(){$("#Tip").stop().fadeOut(300)},3e3)):void(document.xhr=$.ajax({url:a,type:"post",data:(b?$("form[name="+b+"]").serialize()+"&":"")+c,dataType:"json",success:function success(a){switch(a.result){case"SEND":alert("\uCABD\uC9C0\uAC00 \uC804\uC1A1\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),setTimeout(function(){$(".select_btn[tar_obj=select_view02]").removeClass("select_btn_selected").click(),$(".mask").click()},1);break;case"MSG_DEL":$(".msg_el_con[msg_seq="+a.arr.MsgSeq+"]").slideUp(300,function(){$(this).remove()}),$(".mask").click();break;case"SET_BLOCK":"Y"==a.arr.isBlock?(fShowBlock(!0,!0),$(".msg_el_con[member_seq="+a.arr.MemberSeq+"]").addClass("msg_el_block")):(fShowBlock(!1,!0),$(".msg_el_con[member_seq="+a.arr.MemberSeq+"]").removeClass("msg_el_block"));break;default:a.result&&alert(a.result);}},error:function error(a){return a.responseText&&"<!--LOGOFF-->"==a.responseText.substr(0,13)?void(top.location="/"):void console.log(a)},complete:function complete(){document.xhr=!1}}))}var pg=0;function fAjax_List(a){document.xhr||(pg++?($("#divProg").slideDown(300),setTimeout(fMakeRow,1e3)):fMakeRow(),document.xhr=$.ajax({type:"post",data:"PG="+pg+(a?"&"+a:""),dataType:"json",success:function success(a){switch(a.result){case"LIST_RECEIVE":case"LIST_SEND":document.r=a,fMakeRow();break;default:$("#divProg").slideUp(),$(window).unbind("scroll");}},error:function error(a){$("#divProg").slideUp(),$(window).unbind("scroll"),console.log(a)}}))}function fMakeRow(){if(!document.isShow)return void(document.isShow=!0);if("LIST_RECEIVE"==document.r.result){var a,b=$("#select_view01 .msg_el_con:first");document.r.arr.forEach(function(c){a=b.clone(),a.attr("msg_seq",c.Seq).attr("member_seq",c.sender),c.BlockMemberSeq&&a.addClass("msg_el_block"),a.find(".msg_user_img").attr("src","/UploadFile/Profile/"+(c.senderPhoto?c.senderPhoto:"img_thum_base0.jpg")),a.find(".msg_user_name").text(c.senderNic),a.find(".msg_time").text(c.conDate),a.find(".msg_user_text").text(c.contents),a.appendTo("#select_view01").slideDown()}),$(window).unbind("scroll"),document.r.arr.length&&$(window).scroll(function(){150>$(window).scrollBottom()&&fAjax_List("ACT=LIST_RECEIVE")})}else if("LIST_SEND"==document.r.result){var a,b=$("#select_view02 .msg_el_con:first");document.r.arr.forEach(function(c){a=b.clone(),a.attr("msg_seq",c.Seq).attr("member_seq",c.receiver),c.BlockMemberSeq&&a.addClass("msg_el_block"),a.find(".msg_user_img").attr("src","/UploadFile/Profile/"+(c.receiverPhoto?c.receiverPhoto:"img_thum_base0.jpg")),a.find(".msg_user_name").text(c.receiverNic),a.find(".msg_time").text(c.conDate),a.find(".msg_user_text").text(c.contents),a.find(".msg_user_read").text(c.is_read),a.appendTo("#select_view02").slideDown()}),$(window).unbind("scroll"),document.r.arr.length&&$(window).scroll(function(){150>$(window).scrollBottom()&&fAjax_List("ACT=LIST_SEND")})}$("#divProg").slideUp(),document.isShow=!1,document.xhr=!1}function fMsgDel(a,b){if(a.stopPropagation(),confirm("\uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")){var c=$(b).closest(".msg_el_con").attr("msg_seq");fAjax("/Message/message.alt","","ACT=MSG_DEL&MsgSeq="+c)}}$(".user_send_btn").click(function(){var a=$(this).closest(".user_message").find("form");fAjax("/Message/message.alt","","ACT=SEND&"+a.serialize())}),$(".msg_del_btn").click(function(){if(confirm("\uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")){var a=$(this).closest(".user_message").find("form");fAjax("/Message/message.alt","","ACT=MSG_DEL&"+a.serialize())}}),$(".user_message_block").click(fSetBlock),document.querySelectorAll(".user_message_close").forEach(function(a){a.addEventListener("click",closeAll(a))}),$(document).ready(function(){selectView(),fAjax_List("ACT=LIST_RECEIVE"),$.fn.scrollBottom=function(){return $(document).height()-this.scrollTop()-this.height()},$(window).resize(checkDeviceSize)});